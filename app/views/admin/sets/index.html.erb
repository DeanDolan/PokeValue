<% groups = (@groups || []) %>

<style>
  .admin-sets-table{width:100%;font-size:.78rem;border-collapse:collapse}
  .admin-sets-table thead th,.admin-sets-table tbody td{vertical-align:middle;text-align:center;padding:.35rem .4rem;line-height:1.2}
  .admin-sets-table thead th{font-size:.78rem;font-weight:700;white-space:nowrap}
  .admin-sets-table .col-img{width:70px}
  .admin-sets-table .col-name{width:220px}
  .admin-sets-table .col-release{width:170px}
  .admin-sets-table .col-cs{width:160px}
  .admin-sets-table .col-total{width:170px}
  .admin-sets-table .thumb{height:44px;width:auto;object-fit:contain}
  .admin-sets-card{border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;margin-bottom:16px}
  .admin-sets-card .card-head{background:#f8fafc;padding:10px 12px;font-weight:700;text-align:center}
  .admin-sets-card .card-body{padding:0}
  .admin-sets-actions{display:flex;justify-content:flex-end;gap:8px;padding:10px 12px}
</style>

<div class="container py-3">
  <%= form_with url: "/admin/sets/update_values", method: :patch, local: true do %>
    <% groups.each do |era, rows| %>
      <% next if rows.blank? %>

      <div class="admin-sets-card">
        <div class="card-head"><%= era %></div>

        <div class="table-responsive">
          <table class="table table-bordered admin-sets-table mb-0">
            <thead class="table-light">
              <tr>
                <th class="col-img">Set</th>
                <th class="col-name">Name</th>
                <th class="col-release">Release Date</th>
                <th class="col-cs">Cards/Secret</th>
                <th class="col-total">Total Set Value</th>
              </tr>
            </thead>

            <tbody>
              <% rows.each do |r| %>
                <tr>
                  <td>
                    <%= link_to set_path(slug: r[:slug]) do %>
                      <%= image_tag r[:img_url], alt: r[:name], class: "thumb" %>
                    <% end %>
                  </td>

                  <td class="text-center">
                    <%= link_to r[:name], set_path(slug: r[:slug]), class: "text-decoration-none" %>
                  </td>

                  <td><%= r[:release_date].presence || (r[:release_raw].presence || "â€”") %></td>

                  <td>
                    <div class="d-flex justify-content-center gap-2">
                      <input class="form-control form-control-sm text-center"
                             style="max-width:90px"
                             type="number"
                             min="0"
                             step="1"
                             name="cards[<%= r[:slug] %>]"
                             value="<%= r[:cards] %>">

                      <input class="form-control form-control-sm text-center"
                             style="max-width:90px"
                             type="number"
                             min="0"
                             step="1"
                             name="secret_cards[<%= r[:slug] %>]"
                             value="<%= r[:secret_cards] %>">
                    </div>
                  </td>

                  <td>
                    <input class="form-control form-control-sm text-center"
                           style="max-width:160px;margin:0 auto"
                           type="number"
                           min="0"
                           step="0.01"
                           name="total_values[<%= r[:slug] %>]"
                           value="<%= r[:total_value] %>">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% end %>

    <div class="admin-sets-actions">
      <button class="btn btn-primary btn-sm" type="submit">Update Sets</button>
    </div>
  <% end %>
</div>
