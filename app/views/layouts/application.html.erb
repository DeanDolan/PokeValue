<!--
  References:
  - Rails layouts and rendering:
    https://guides.rubyonrails.org/layouts_and_rendering.html
  - Rails security (CSRF + Content Security Policy):
    https://guides.rubyonrails.org/security.html
  - Bootstrap 5 docs (layout, navbar, alerts, modals):
    https://getbootstrap.com/docs/5.3/getting-started/introduction/
-->

<!DOCTYPE html>
<html>
  <head>
    <title>PokeValueApp</title>

    <!-- Rails meta tags so forms and remote requests are protected -->
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Import mapped JS (Rails 7 default setup) -->
    <%= javascript_importmap_tags %>

    <!-- Bootstrap 5 CSS from CDN for layout and components -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  </head>

  <body>
    <!-- Main navbar is shared across every page -->
    <%= render "shared/navbar" %>

    <!-- Global flash messages (success, error etc.) -->
    <div class="container mt-3">
      <% flash.each do |type, msg| %>
        <% bs = (type.to_s == "alert" ? "danger" : type.to_s == "notice" ? "success" : "info") %>
        <div class="alert alert-<%= bs %> alert-dismissible fade show mb-3" role="alert">
          <%= msg %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>
    </div>

    <!-- Main page content placeholder â€“ each view is rendered into this -->
    <div class="container mt-2">
      <%= yield %>
    </div>

    <!-- Shared footer below the main content -->
    <%= render "shared/footer" %>

    <!-- Auth modal lives in the layout so I can trigger it from anywhere (navbar MyAccount, buttons, etc.) -->
    <div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="authModalLabel">Welcome</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cancel"></button>
          </div>

          <div class="modal-body">
            <!-- Tabs let me switch between Login and Register inside the same modal -->
            <ul class="nav nav-tabs" id="authTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="login-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#login-pane"
                  type="button"
                  role="tab"
                  aria-controls="login-pane"
                  aria-selected="true">
                  Login
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="register-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#register-pane"
                  type="button"
                  role="tab"
                  aria-controls="register-pane"
                  aria-selected="false">
                  Register
                </button>
              </li>
            </ul>

            <!-- Each tab just renders a partial for its form -->
            <div class="tab-content pt-3">
              <div
                class="tab-pane fade show active"
                id="login-pane"
                role="tabpanel"
                aria-labelledby="login-tab"
                tabindex="0">
                <%= render "sessions/form" %>
              </div>

              <div
                class="tab-pane fade"
                id="register-pane"
                role="tabpanel"
                aria-labelledby="register-tab"
                tabindex="0">
                <%= render "registrations/form" %>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <!-- Simple cancel button to close the modal -->
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS bundle so modals, nav collapse, alerts etc. work -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  </body>
</html>
